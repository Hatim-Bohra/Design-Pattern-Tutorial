[{"filePath":"D:\\Design Pattern Tutorial\\design-pattern-tutorial\\src\\components\\features\\command\\CommandDemo.tsx","messages":[{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nD:\\Design Pattern Tutorial\\design-pattern-tutorial\\src\\components\\features\\command\\CommandDemo.tsx:87:45\n  85 |                     key={`h-${cmd.label}-${i}`} // Use index to allow duplicates but unique keys logic\n  86 |                     initial={{ left: 600, top: 250, opacity: 0, scale: 0 }}\n> 87 |                     animate={{ left: 200 + (Math.random() * 20 - 10), top: 250 + (Math.random() * 20 - 10), opacity: 1, scale: 1 }}\n     |                                             ^^^^^^^^^^^^^ Cannot call impure function\n  88 |                     exit={{ left: 600, top: 250, opacity: 0, scale: 0 }}\n  89 |                     transition={{ type: \"spring\", stiffness: 300, damping: 25 }}\n  90 |                     className=\"absolute w-8 h-8 bg-indigo-500 text-white rounded-md flex items-center justify-center text-[10px] font-bold shadow-sm z-10\"","line":87,"column":45,"nodeType":null,"endLine":87,"endColumn":58},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nD:\\Design Pattern Tutorial\\design-pattern-tutorial\\src\\components\\features\\command\\CommandDemo.tsx:87:83\n  85 |                     key={`h-${cmd.label}-${i}`} // Use index to allow duplicates but unique keys logic\n  86 |                     initial={{ left: 600, top: 250, opacity: 0, scale: 0 }}\n> 87 |                     animate={{ left: 200 + (Math.random() * 20 - 10), top: 250 + (Math.random() * 20 - 10), opacity: 1, scale: 1 }}\n     |                                                                                   ^^^^^^^^^^^^^ Cannot call impure function\n  88 |                     exit={{ left: 600, top: 250, opacity: 0, scale: 0 }}\n  89 |                     transition={{ type: \"spring\", stiffness: 300, damping: 25 }}\n  90 |                     className=\"absolute w-8 h-8 bg-indigo-500 text-white rounded-md flex items-center justify-center text-[10px] font-bold shadow-sm z-10\"","line":87,"column":83,"nodeType":null,"endLine":87,"endColumn":96}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState } from \"react\";\r\nimport { SvgCanvas } from \"@/components/shared/demo-framework/SvgCanvas\";\r\nimport { Node } from \"@/components/shared/demo-framework/Node\";\r\nimport { DemoShell } from \"@/components/shared/DemoShell\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\n\r\ninterface Command {\r\n  execute: () => void;\r\n  undo: () => void;\r\n  label: string;\r\n}\r\n\r\nexport const CommandDemo = () => {\r\n  const [text, setText] = useState(\"\");\r\n  const [history, setHistory] = useState<Command[]>([]);\r\n  const [future, setFuture] = useState<Command[]>([]);\r\n\r\n  const executeCommand = (cmd: Command) => {\r\n    cmd.execute();\r\n    setHistory([...history, cmd]);\r\n    setFuture([]); // Clear redo stack on new action\r\n  };\r\n\r\n  const undo = () => {\r\n    if (history.length === 0) return;\r\n    const lastCmd = history[history.length - 1];\r\n    if (!lastCmd) return;\r\n    lastCmd.undo();\r\n    setHistory(history.slice(0, -1));\r\n    setFuture([lastCmd, ...future]);\r\n  };\r\n\r\n  const redo = () => {\r\n    if (future.length === 0) return;\r\n    const nextCmd = future[0];\r\n    if (!nextCmd) return;\r\n    nextCmd.execute();\r\n    setFuture(future.slice(1));\r\n    setHistory([...history, nextCmd]);\r\n  };\r\n\r\n  const createAppendCommand = (char: string): Command => ({\r\n    label: `Type '${char}'`,\r\n    execute: () => setText((prev) => prev + char),\r\n    undo: () => setText((prev) => prev.slice(0, -1)),\r\n  });\r\n\r\n  return (\r\n    <DemoShell\r\n      title=\"Undo/Redo Editor\"\r\n      description=\"Commands are objects that can be stored, executed, and undone.\"\r\n      onReset={() => {\r\n        setText(\"\");\r\n        setHistory([]);\r\n        setFuture([]);\r\n      }}\r\n    >\r\n      <div className=\"relative h-[400px] flex flex-col\">\r\n        <SvgCanvas className=\"flex-1\">\r\n          <foreignObject x={250} y={50} width={300} height={100}>\r\n            <div className=\"bg-white border rounded p-4 text-2xl font-mono min-h-full flex items-center justify-center shadow-inner\">\r\n              {text || <span className=\"text-slate-300\">Start typing...</span>}\r\n            </div>\r\n          </foreignObject>\r\n\r\n          {/* Stacks Visualization */}\r\n          <Node\r\n            id=\"history\"\r\n            type=\"source\"\r\n            x={200}\r\n            y={250}\r\n            label={`Undo Stack (${history.length})`}\r\n            className=\"fill-indigo-50 stroke-indigo-500 text-indigo-900\"\r\n          />\r\n          <Node id=\"future\" type=\"target\" x={600} y={250} label={`Redo Stack (${future.length})`} className=\"fill-amber-50 stroke-amber-500 text-amber-900\" />\r\n\r\n          {/* Command Objects Animation */}\r\n          <foreignObject x={0} y={0} width={1000} height={600} className=\"pointer-events-none\">\r\n            <motion.div className=\"absolute inset-0\">\r\n              <AnimatePresence>\r\n                {history.map((cmd, i) => (\r\n                  <motion.div\r\n                    key={`h-${cmd.label}-${i}`} // Use index to allow duplicates but unique keys logic\r\n                    initial={{ left: 600, top: 250, opacity: 0, scale: 0 }}\r\n                    animate={{ left: 200 + (Math.random() * 20 - 10), top: 250 + (Math.random() * 20 - 10), opacity: 1, scale: 1 }}\r\n                    exit={{ left: 600, top: 250, opacity: 0, scale: 0 }}\r\n                    transition={{ type: \"spring\", stiffness: 300, damping: 25 }}\r\n                    className=\"absolute w-8 h-8 bg-indigo-500 text-white rounded-md flex items-center justify-center text-[10px] font-bold shadow-sm z-10\"\r\n                    style={{ marginLeft: -16, marginTop: -16 }} // Center\r\n                  >\r\n                    {cmd.label.split(\"'\")[1]}\r\n                  </motion.div>\r\n                ))}\r\n              </AnimatePresence>\r\n            </motion.div>\r\n          </foreignObject>\r\n        </SvgCanvas>\r\n\r\n        {/* Controls */}\r\n        <div className=\"absolute bottom-8 left-1/2 -translate-x-1/2 flex gap-4 bg-white/80 p-4 rounded-2xl shadow-xl border border-slate-100 backdrop-blur-sm pointer-events-auto\">\r\n          <div className=\"flex gap-2\">\r\n            {[\"A\", \"B\", \"C\"].map((char) => (\r\n              <button\r\n                type=\"button\"\r\n                key={char}\r\n                onClick={() => executeCommand(createAppendCommand(char))}\r\n                className=\"w-12 h-12 rounded-xl bg-slate-900 text-white font-bold shadow-lg hover:scale-110 hover:bg-slate-800 transition-all active:scale-95 text-lg\"\r\n              >\r\n                {char}\r\n              </button>\r\n            ))}\r\n          </div>\r\n          <div className=\"w-px bg-slate-200 mx-2\"></div>\r\n          <button\r\n            type=\"button\"\r\n            onClick={undo}\r\n            disabled={history.length === 0}\r\n            className=\"px-6 py-2 bg-amber-500 text-white rounded-xl font-bold disabled:opacity-50 disabled:cursor-not-allowed shadow hover:bg-amber-600 transition-colors flex items-center gap-2\"\r\n          >\r\n            <span>Γå⌐</span> Undo\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={redo}\r\n            disabled={future.length === 0}\r\n            className=\"px-6 py-2 bg-indigo-500 text-white rounded-xl font-bold disabled:opacity-50 disabled:cursor-not-allowed shadow hover:bg-indigo-600 transition-colors flex items-center gap-2\"\r\n          >\r\n            Redo <span>Γå¬</span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </DemoShell>\r\n  );\r\n};\r\n","usedDeprecatedRules":[]}]
